# Building Fexo APK for Production

## Prerequisites

1. **Java JDK 11+** installed
2. **Android SDK** installed (via Android Studio)
3. **Node.js** and npm installed
4. All dependencies installed: `npm install`

## Quick Build (Unsigned Debug)

For testing purposes, you can build an unsigned debug APK:

```powershell
# Run the automated build script
.\build-apk.ps1
```

This will create `fexo-debug.apk` in the FexoApp folder.

## Production Build (Signed Release)

For Google Play Store or production distribution, you need a signed release APK.

### Step 1: Create a Keystore

Open terminal in the `FexoApp` directory and run:

```cmd
keytool -genkeypair -v -storetype PKCS12 -keystore android\fexo-release.keystore -alias fexo-release-key -keyalg RSA -keysize 2048 -validity 10000
```

You'll be prompted for:
- **Keystore password**: Choose a strong password (remember this!)
- **Key password**: Can be the same as keystore password
- **Name**: Your name or company name
- **Organization**: Your company name
- **City, State, Country**: Your location details

**IMPORTANT**: Save these passwords securely! You'll need them for all future updates.

### Step 2: Create key.properties

Copy the example file:
```cmd
copy android\key.properties.example android\key.properties
```

Edit `android\key.properties` with your actual values:
```properties
storePassword=YOUR_ACTUAL_KEYSTORE_PASSWORD
keyPassword=YOUR_ACTUAL_KEY_PASSWORD
keyAlias=fexo-release-key
storeFile=fexo-release.keystore
```

**NEVER commit this file to Git!** (It's already in .gitignore)

### Step 3: Build Signed APK

Run the build script:
```powershell
.\build-apk.ps1
```

This will create `fexo-release.apk` - a signed, production-ready APK!

## Manual Build Commands

If you prefer manual control:

### Debug Build:
```cmd
npm run build
npx cap sync android
cd android
gradlew assembleDebug
```
APK location: `android\app\build\outputs\apk\debug\app-debug.apk`

### Release Build (requires keystore):
```cmd
npm run build
npx cap sync android
cd android
gradlew assembleRelease
```
APK location: `android\app\build\outputs\apk\release\app-release.apk`

## Building AAB for Google Play

For Google Play Store, you need an AAB (Android App Bundle):

```cmd
npm run build
npx cap sync android
cd android
gradlew bundleRelease
```

AAB location: `android\app\build\outputs\bundle\release\app-release.aab`

## Version Management

Update version in `android\app\build.gradle`:

```gradle
versionCode 2        // Increment for each release
versionName "1.0.1"  // Semantic versioning
```

## Pre-Release Checklist

- [ ] Update `versionCode` and `versionName`
- [ ] Test on multiple devices/Android versions
- [ ] Verify all permissions work (location, notifications)
- [ ] Test Google Maps integration with live navigation
- [ ] Check voice guidance works
- [ ] Verify notifications appear
- [ ] Test in airplane mode (offline functionality)
- [ ] Check app size (should be < 50MB)
- [ ] Run through core user flows
- [ ] Test dark/light themes
- [ ] Verify no console errors

## Optimization Tips

### Reduce APK Size:
1. Already enabled: minify, shrinkResources in build.gradle
2. Use WebP images instead of PNG
3. Remove unused assets from `public/`
4. Consider splitting by ABI (creates multiple APKs)

### Performance:
1. Already enabled: ProGuard optimization
2. Test on low-end devices (Android 7.0+)
3. Monitor memory usage during navigation

## Common Issues

### "BUILD FAILED" Error:
- Check Java version: `java -version` (need 11+)
- Clean build: `cd android && gradlew clean`
- Update Gradle: Edit `android\gradle\wrapper\gradle-wrapper.properties`

### "Keystore not found" Error:
- Verify path in `key.properties`
- Ensure keystore file exists in `android/` folder

### APK Won't Install:
- Enable "Install from Unknown Sources" on device
- Check minimum Android version (minSdk in build.gradle)
- Verify signature if updating existing app

### Google Maps Not Working:
- Check `VITE_GOOGLE_MAPS_API_KEY` in `.env`
- Verify API key has proper restrictions for Android

## Testing the APK

### On Physical Device:
1. Enable Developer Options
2. Enable USB Debugging
3. Connect via USB
4. Run: `adb install fexo-release.apk`

### Via File Transfer:
1. Copy APK to device
2. Open file manager
3. Tap APK to install
4. Grant "Install Unknown Apps" permission

### Firebase App Distribution (Recommended):
1. Upload APK to Firebase
2. Share link with testers
3. Collect feedback and crash reports

## Publishing to Google Play

1. **Create Google Play Console Account** ($25 one-time fee)
2. **Create App Listing**:
   - Title: Fexo
   - Short description (80 chars)
   - Full description (4000 chars)
   - Screenshots (at least 2)
   - Feature graphic (1024x500)
   - App icon (512x512)
   
3. **Upload AAB**:
   - Build AAB: `gradlew bundleRelease`
   - Upload to Production/Beta/Internal Testing track
   
4. **Complete Store Listing**:
   - Privacy Policy URL
   - Contact email
   - Category: Productivity / AI / Tools
   
5. **Content Rating**:
   - Complete questionnaire
   - Should be rated 3+ or Everyone
   
6. **Review and Publish**:
   - Submit for review (1-7 days)
   - Monitor for approval

## App Store Assets Needed

### Icons:
- 512x512 high-res icon (for Play Store)
- Already included in `android/app/src/main/res/mipmap-*`

### Screenshots (at least 2):
- Phone: 1080x1920 or 1440x2560
- Show main features:
  1. Chat interface with AI
  2. Google Maps with navigation
  3. Voice chat
  4. Settings/features

### Feature Graphic:
- 1024x500 banner for Play Store
- Show app name and key features

### Promo Video (Optional):
- 30 seconds to 2 minutes
- Show app in action
- Upload to YouTube, add link

## Support After Launch

- Monitor crash reports in Play Console
- Respond to user reviews
- Regular updates for bug fixes
- Version updates every 2-3 months

## Files to Keep Secure

**NEVER share or commit:**
- `android/fexo-release.keystore`
- `android/key.properties`
- Google Play Console credentials
- API keys in production

**Backup securely:**
- Keystore file (you'll need it for updates!)
- key.properties values
- Store in password manager or encrypted storage

---

## Quick Reference

```cmd
# Development build (unsigned)
.\build-apk.ps1

# Production build (signed)
# 1. Create keystore (one time)
keytool -genkeypair -v -storetype PKCS12 -keystore android\fexo-release.keystore -alias fexo-release-key -keyalg RSA -keysize 2048 -validity 10000

# 2. Configure key.properties

# 3. Build
.\build-apk.ps1

# Install on connected device
adb install fexo-release.apk

# View device logs
adb logcat | findstr Fexo
```

---

**You're now ready to build a production APK!** ðŸš€
